<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡ç« ç®¡ç† - ç‘„ç‘„çš„æ—…éŠæ—¥è¨˜</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: #2d6a4f;
      --primary-dark: #1b4332;
      --primary-light: #52b788;
      --bg: #f5f6fa;
      --bg-white: #ffffff;
      --text: #2d3436;
      --text-light: #636e72;
      --border: #e0e0e0;
      --danger: #e74c3c;
      --danger-hover: #c0392b;
      --radius: 12px;
      --shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
    }
    .admin-header {
      background: var(--primary-dark);
      color: #fff;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .admin-header h1 { font-size: 20px; font-weight: 700; }
    .admin-header a {
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      font-size: 14px;
      padding: 6px 16px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      transition: 0.3s;
    }
    .admin-header a:hover { background: rgba(255,255,255,0.1); color: #fff; }

    .admin-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
    }

    .tabs {
      display: flex;
      gap: 0;
      margin-bottom: 24px;
      border-bottom: 2px solid var(--border);
    }
    .tab-btn {
      padding: 12px 24px;
      background: none;
      border: none;
      font-size: 15px;
      font-weight: 600;
      color: var(--text-light);
      cursor: pointer;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      font-family: inherit;
      transition: 0.2s;
    }
    .tab-btn.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
    .tab-btn:hover { color: var(--primary); }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Form Styles */
    .form-card {
      background: var(--bg-white);
      border-radius: var(--radius);
      padding: 28px;
      box-shadow: var(--shadow);
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
    }
    .form-group label .required {
      color: var(--danger);
      margin-left: 2px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 14px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
      transition: border-color 0.2s;
      outline: none;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: var(--primary-light);
    }
    .form-group textarea {
      min-height: 200px;
      resize: vertical;
      line-height: 1.8;
    }
    .form-group .hint {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 4px;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .image-preview {
      margin-top: 8px;
      max-width: 300px;
      border-radius: 8px;
      overflow: hidden;
      display: none;
    }
    .image-preview img {
      width: 100%;
      display: block;
    }

    .btn {
      padding: 10px 28px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: 0.2s;
    }
    .btn-primary {
      background: var(--primary);
      color: #fff;
    }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-danger {
      background: var(--danger);
      color: #fff;
    }
    .btn-danger:hover { background: var(--danger-hover); }
    .btn-secondary {
      background: #dfe6e9;
      color: var(--text);
    }
    .btn-secondary:hover { background: #b2bec3; }
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    /* Article List Styles */
    .article-table {
      background: var(--bg-white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .article-row {
      display: grid;
      grid-template-columns: 80px 1fr 100px 100px 120px;
      gap: 12px;
      align-items: center;
      padding: 14px 20px;
      border-bottom: 1px solid var(--border);
      transition: background 0.2s;
    }
    .article-row:hover { background: #f8f9fa; }
    .article-row:last-child { border-bottom: none; }
    .article-row.header {
      background: var(--primary-dark);
      color: #fff;
      font-weight: 600;
      font-size: 13px;
    }
    .article-row.header:hover { background: var(--primary-dark); }
    .article-row-thumb {
      width: 70px;
      height: 48px;
      border-radius: 6px;
      overflow: hidden;
    }
    .article-row-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .article-row-title {
      font-size: 14px;
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .article-row-country {
      font-size: 13px;
      color: var(--text-light);
    }
    .article-row-date {
      font-size: 13px;
      color: var(--text-light);
    }
    .article-row-actions {
      display: flex;
      gap: 6px;
    }
    .btn-sm {
      padding: 5px 12px;
      font-size: 12px;
      border-radius: 6px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
    }
    .empty-state .icon { font-size: 48px; margin-bottom: 12px; }

    /* Toast */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 14px 24px;
      background: var(--primary);
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 9999;
      opacity: 0;
      transform: translateY(-10px);
      transition: 0.3s;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast.error { background: var(--danger); }

    /* Rich Editor */
    .editor-toolbar {
      display: flex;
      gap: 4px;
      padding: 8px 10px;
      background: #f1f3f5;
      border: 2px solid var(--border);
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      flex-wrap: wrap;
    }
    .toolbar-btn {
      padding: 5px 10px;
      background: var(--bg-white);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-family: inherit;
      transition: 0.2s;
      line-height: 1.2;
    }
    .toolbar-btn:hover { background: #e2e8f0; }
    .toolbar-sep {
      width: 1px;
      background: var(--border);
      margin: 0 4px;
    }
    .rich-editor {
      width: 100%;
      min-height: 300px;
      padding: 16px;
      border: 2px solid var(--border);
      border-radius: 0 0 8px 8px;
      font-size: 15px;
      font-family: inherit;
      line-height: 1.9;
      outline: none;
      transition: border-color 0.2s;
      overflow-y: auto;
      max-height: 600px;
    }
    .rich-editor:focus { border-color: var(--primary-light); }
    .rich-editor:empty::before {
      content: attr(placeholder);
      color: #adb5bd;
      pointer-events: none;
    }
    .rich-editor img {
      max-width: 100%;
      border-radius: 8px;
      margin: 12px 0;
      display: block;
    }
    .rich-editor h3 {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-dark);
      margin: 20px 0 8px;
      padding-left: 12px;
      border-left: 4px solid var(--primary);
    }

    @media (max-width: 768px) {
      .form-row { grid-template-columns: 1fr; }
      .article-row {
        grid-template-columns: 1fr;
        gap: 6px;
      }
      .article-row.header { display: none; }
      .article-row-thumb { display: none; }
    }
  </style>
</head>
<body>
  <header class="admin-header">
    <h1>ğŸ“ æ–‡ç« ç®¡ç†å¾Œå°</h1>
    <a href="index.html">â† å›åˆ°ç¶²ç«™</a>
  </header>

  <div class="admin-container">
    <div class="tabs">
      <button class="tab-btn active" data-tab="add">æ–°å¢æ–‡ç« </button>
      <button class="tab-btn" data-tab="manage">ç®¡ç†æ–‡ç«  (<span id="articleCountBadge">0</span>)</button>
    </div>

    <!-- Add Article Tab -->
    <div class="tab-content active" id="tab-add">
      <div class="form-card">
        <input type="hidden" id="editId" value="">
        <div class="form-row">
          <div class="form-group">
            <label>æ–‡ç« æ¨™é¡Œ <span class="required">*</span></label>
            <input type="text" id="formTitle" placeholder="ä¾‹ï¼šæ±äº¬äº”å¤©å››å¤œè‡ªç”±è¡Œ">
          </div>
          <div class="form-group">
            <label>åœ‹å®¶ <span class="required">*</span></label>
            <select id="formCountrySelect" style="margin-bottom:8px;">
              <option value="_custom">âœï¸ è‡ªè¨‚åœ‹å®¶ï¼ˆæ‰‹å‹•è¼¸å…¥ï¼‰</option>
            </select>
            <div id="customCountryFields" style="display:flex;gap:8px;">
              <input type="text" id="formCountryName" placeholder="åœ‹å®¶åç¨±ï¼Œä¾‹ï¼šæ—¥æœ¬" style="flex:1;">
              <input type="text" id="formCountryEmoji" placeholder="åœ‹æ—— emoji" style="width:80px;text-align:center;">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>æ–‡ç« æ‘˜è¦ <span class="required">*</span></label>
          <textarea id="formExcerpt" rows="3" placeholder="ç°¡çŸ­æè¿°é€™ç¯‡æ–‡ç« çš„å…§å®¹...ï¼ˆé¡¯ç¤ºåœ¨é¦–é å¡ç‰‡ä¸Šï¼‰" style="min-height:80px;"></textarea>
        </div>

        <div class="form-group">
          <label>æ–‡ç« å…§å®¹ <span class="required">*</span></label>
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" onclick="editorCmd('bold')" title="ç²—é«”"><b>B</b></button>
            <button type="button" class="toolbar-btn" onclick="editorCmd('italic')" title="æ–œé«”"><i>I</i></button>
            <span class="toolbar-sep"></span>
            <button type="button" class="toolbar-btn" onclick="insertHeading()" title="å°æ¨™é¡Œ">H3</button>
            <span class="toolbar-sep"></span>
            <button type="button" class="toolbar-btn" onclick="insertImageFromUrl()" title="æ’å…¥åœ–ç‰‡ç¶²å€">ğŸ–¼ï¸ ç¶²å€</button>
            <button type="button" class="toolbar-btn" onclick="document.getElementById('imageUpload').click()" title="ä¸Šå‚³åœ–ç‰‡">ğŸ“· ä¸Šå‚³</button>
            <input type="file" id="imageUpload" accept="image/*" multiple style="display:none;" onchange="handleImageUpload(event)">
            <span class="toolbar-sep"></span>
            <button type="button" class="toolbar-btn" onclick="editorCmd('removeFormat')" title="æ¸…é™¤æ ¼å¼">ğŸš«</button>
          </div>
          <div id="formContent" class="rich-editor" contenteditable="true" placeholder="å¯«ä¸‹ä½ çš„æ—…éŠæ•…äº‹... å¯ä»¥ç›´æ¥è²¼ä¸Šåœ–ç‰‡ï¼ˆCtrl+Vï¼‰"></div>
          <p class="hint">å¯ä»¥ç›´æ¥å¾å‰ªè²¼ç°¿è²¼ä¸Šåœ–ç‰‡ï¼ˆCtrl+Vï¼‰ï¼Œæˆ–ç”¨ä¸Šæ–¹æŒ‰éˆ•æ’å…¥åœ–ç‰‡</p>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>å°é¢åœ–ç‰‡ç¶²å€</label>
            <input type="text" id="formImage" placeholder="https://... ï¼ˆç•™ç©ºä½¿ç”¨é è¨­åœ–ç‰‡ï¼‰">
            <div class="image-preview" id="imagePreview">
              <img id="previewImg" src="" alt="preview">
            </div>
          </div>
          <div class="form-group">
            <label>æ¨™ç±¤</label>
            <input type="text" id="formTags" placeholder="ç”¨é€—è™Ÿåˆ†éš”ï¼Œä¾‹ï¼šè‡ªç”±è¡Œ, æ”»ç•¥, ç¾é£Ÿ">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ç™¼å¸ƒæ—¥æœŸ</label>
            <input type="date" id="formDate">
          </div>
          <div class="form-group">
            <label>é–±è®€æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
            <input type="number" id="formReadTime" value="5" min="1" max="60">
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" id="btnSave">ç™¼å¸ƒæ–‡ç« </button>
          <button class="btn btn-secondary" id="btnClear">æ¸…ç©ºè¡¨å–®</button>
        </div>
      </div>
    </div>

    <!-- Manage Articles Tab -->
    <div class="tab-content" id="tab-manage">
      <div class="article-table" id="articleTable">
        <div class="article-row header">
          <div>ç¸®åœ–</div>
          <div>æ¨™é¡Œ</div>
          <div>åœ‹å®¶</div>
          <div>æ—¥æœŸ</div>
          <div>æ“ä½œ</div>
        </div>
        <!-- rows rendered by JS -->
      </div>
      <div class="empty-state" id="emptyState" style="display:none;">
        <div class="icon">ğŸ“„</div>
        <h3>é‚„æ²’æœ‰æ–°å¢ä»»ä½•æ–‡ç« </h3>
        <p>é»ä¸Šæ–¹çš„ã€Œæ–°å¢æ–‡ç« ã€é–‹å§‹å¯«ä½ çš„ç¬¬ä¸€ç¯‡ï¼</p>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="js/data.js"></script>
  <script>
    const STORAGE_KEY = 'user_articles';

    function getUserArticles() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    }
    function saveUserArticles(articles) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(articles));
    }
    function getNextId() {
      const userArticles = getUserArticles();
      const maxBuiltIn = Math.max(...ARTICLES.map(a => a.id), 0);
      const maxUser = userArticles.length > 0 ? Math.max(...userArticles.map(a => a.id)) : maxBuiltIn;
      return Math.max(maxBuiltIn, maxUser) + 1;
    }

    function showToast(msg, isError = false) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = 'toast' + (isError ? ' error' : '');
      setTimeout(() => t.classList.add('show'), 10);
      setTimeout(() => t.classList.remove('show'), 2500);
    }

    function markdownToHtml(text) {
      return text.split('\n').map(line => {
        line = line.trim();
        if (!line) return '';
        if (line.startsWith('### ')) return `<h3>${line.slice(4)}</h3>`;
        return `<p>${line}</p>`;
      }).join('\n');
    }

    // Rich Editor functions
    function editorCmd(cmd) {
      document.execCommand(cmd, false, null);
      document.getElementById('formContent').focus();
    }

    function insertHeading() {
      const text = window.getSelection().toString() || 'å°æ¨™é¡Œ';
      document.execCommand('insertHTML', false, `<h3>${text}</h3><p><br></p>`);
    }

    function insertImageFromUrl() {
      const url = prompt('è«‹è¼¸å…¥åœ–ç‰‡ç¶²å€ï¼š');
      if (url && url.trim()) {
        document.execCommand('insertHTML', false, `<img src="${url.trim()}" alt=""><br>`);
      }
    }

    function handleImageUpload(event) {
      const files = event.target.files;
      for (const file of files) {
        if (!file.type.startsWith('image/')) continue;
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('formContent').focus();
          document.execCommand('insertHTML', false, `<img src="${e.target.result}" alt=""><br>`);
        };
        reader.readAsDataURL(file);
      }
      event.target.value = '';
    }

    // Handle paste images (Ctrl+V)
    document.addEventListener('DOMContentLoaded', () => {
      const editor = document.getElementById('formContent');
      editor.addEventListener('paste', function(e) {
        const items = e.clipboardData?.items;
        if (!items) return;
        for (const item of items) {
          if (item.type.startsWith('image/')) {
            e.preventDefault();
            const file = item.getAsFile();
            const reader = new FileReader();
            reader.onload = function(ev) {
              document.execCommand('insertHTML', false, `<img src="${ev.target.result}" alt=""><br>`);
            };
            reader.readAsDataURL(file);
            return;
          }
        }
      });
    });

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      const select = document.getElementById('formCountrySelect');
      COUNTRIES.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.textContent = `${c.emoji} ${c.name}`;
        select.appendChild(opt);
      });

      // Show/hide custom fields
      const customFields = document.getElementById('customCountryFields');
      select.addEventListener('change', () => {
        if (select.value === '_custom') {
          customFields.style.display = 'flex';
          document.getElementById('formCountryName').value = '';
          document.getElementById('formCountryEmoji').value = '';
        } else {
          customFields.style.display = 'none';
          const c = COUNTRIES.find(x => x.id === select.value);
          if (c) {
            document.getElementById('formCountryName').value = c.name;
            document.getElementById('formCountryEmoji').value = c.emoji;
          }
        }
      });
      // Default: show custom fields since _custom is first option
      customFields.style.display = 'flex';

      document.getElementById('formDate').value = new Date().toISOString().split('T')[0];

      // Image preview
      document.getElementById('formImage').addEventListener('input', e => {
        const url = e.target.value.trim();
        const preview = document.getElementById('imagePreview');
        const img = document.getElementById('previewImg');
        if (url) {
          img.src = url;
          preview.style.display = 'block';
          img.onerror = () => { preview.style.display = 'none'; };
        } else {
          preview.style.display = 'none';
        }
      });

      // Tabs
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          btn.classList.add('active');
          document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
        });
      });

      // Save
      document.getElementById('btnSave').addEventListener('click', saveArticle);
      document.getElementById('btnClear').addEventListener('click', clearForm);

      renderArticleList();
    });

    function saveArticle() {
      const title = document.getElementById('formTitle').value.trim();
      const countrySelect = document.getElementById('formCountrySelect').value;
      const countryName = document.getElementById('formCountryName').value.trim();
      const countryEmoji = document.getElementById('formCountryEmoji').value.trim() || 'ğŸŒ';
      const excerpt = document.getElementById('formExcerpt').value.trim();
      const content = document.getElementById('formContent').innerHTML.trim();
      const image = document.getElementById('formImage').value.trim();
      const tags = document.getElementById('formTags').value.trim();
      const date = document.getElementById('formDate').value;
      const readTime = parseInt(document.getElementById('formReadTime').value) || 5;
      const editId = document.getElementById('editId').value;

      if (!title || !excerpt || !content) {
        showToast('è«‹å¡«å¯«æ¨™é¡Œã€æ‘˜è¦å’Œå…§å®¹ï¼', true);
        return;
      }
      if (countrySelect === '_custom' && !countryName) {
        showToast('è«‹è¼¸å…¥åœ‹å®¶åç¨±ï¼', true);
        return;
      }

      // Handle country
      let countryId;
      if (countrySelect !== '_custom') {
        countryId = countrySelect;
      } else {
        countryId = countryName.toLowerCase().replace(/\s+/g, '-');
        // Save custom country to localStorage
        const customCountries = JSON.parse(localStorage.getItem('custom_countries') || '[]');
        if (!customCountries.find(c => c.id === countryId)) {
          customCountries.push({ id: countryId, name: countryName, emoji: countryEmoji, description: countryName + 'æ—…éŠ' });
          localStorage.setItem('custom_countries', JSON.stringify(customCountries));
        }
      }

      const articles = getUserArticles();
      const article = {
        id: editId ? parseInt(editId) : getNextId(),
        country: countryId,
        title,
        excerpt,
        content: content,
        image: image || `https://picsum.photos/seed/${Date.now()}/800/500`,
        date: date || new Date().toISOString().split('T')[0],
        tags: tags ? tags.split(',').map(t => t.trim()).filter(Boolean) : [],
        readTime,
        views: 0,
        isUserArticle: true,
      };

      if (editId) {
        const idx = articles.findIndex(a => a.id === parseInt(editId));
        if (idx >= 0) articles[idx] = article;
        showToast('æ–‡ç« å·²æ›´æ–°ï¼');
      } else {
        articles.push(article);
        showToast('æ–‡ç« å·²ç™¼å¸ƒï¼');
      }

      saveUserArticles(articles);
      clearForm();
      renderArticleList();

      // Switch to manage tab
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector('[data-tab="manage"]').classList.add('active');
      document.getElementById('tab-manage').classList.add('active');
    }

    function clearForm() {
      document.getElementById('formTitle').value = '';
      document.getElementById('formExcerpt').value = '';
      document.getElementById('formContent').innerHTML = '';
      document.getElementById('formImage').value = '';
      document.getElementById('formTags').value = '';
      document.getElementById('formReadTime').value = '5';
      document.getElementById('formDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('editId').value = '';
      document.getElementById('imagePreview').style.display = 'none';
      document.getElementById('btnSave').textContent = 'ç™¼å¸ƒæ–‡ç« ';
    }

    function editArticle(id) {
      const articles = getUserArticles();
      const article = articles.find(a => a.id === id);
      if (!article) return;

      document.getElementById('editId').value = id;
      document.getElementById('formTitle').value = article.title;
      // Set country
      const builtInCountry = COUNTRIES.find(c => c.id === article.country);
      const sel = document.getElementById('formCountrySelect');
      if (builtInCountry) {
        sel.value = article.country;
        document.getElementById('customCountryFields').style.display = 'none';
        document.getElementById('formCountryName').value = builtInCountry.name;
        document.getElementById('formCountryEmoji').value = builtInCountry.emoji;
      } else {
        sel.value = '_custom';
        document.getElementById('customCountryFields').style.display = 'flex';
        const customCountries = JSON.parse(localStorage.getItem('custom_countries') || '[]');
        const cc = customCountries.find(c => c.id === article.country);
        document.getElementById('formCountryName').value = cc ? cc.name : article.country;
        document.getElementById('formCountryEmoji').value = cc ? cc.emoji : 'ğŸŒ';
      }
      document.getElementById('formExcerpt').value = article.excerpt;
      document.getElementById('formContent').innerHTML = article.content;
      document.getElementById('formImage').value = article.image;
      document.getElementById('formTags').value = article.tags.join(', ');
      document.getElementById('formDate').value = article.date;
      document.getElementById('formReadTime').value = article.readTime;
      document.getElementById('btnSave').textContent = 'æ›´æ–°æ–‡ç« ';

      // Switch to add tab
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector('[data-tab="add"]').classList.add('active');
      document.getElementById('tab-add').classList.add('active');

      window.scrollTo({ top: 0, behavior: 'smooth' });
      showToast('å·²è¼‰å…¥æ–‡ç« ï¼Œä¿®æ”¹å¾ŒæŒ‰ã€Œæ›´æ–°æ–‡ç« ã€');
    }

    function htmlToMarkdown(html) {
      return html
        .replace(/<h3>(.*?)<\/h3>/g, '### $1')
        .replace(/<p>(.*?)<\/p>/g, '$1')
        .replace(/<img[^>]*>/g, '')
        .replace(/\n{3,}/g, '\n\n')
        .trim();
    }

    function deleteArticle(id) {
      if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç¯‡æ–‡ç« å—ï¼Ÿ')) return;
      const articles = getUserArticles().filter(a => a.id !== id);
      saveUserArticles(articles);
      renderArticleList();
      showToast('æ–‡ç« å·²åˆªé™¤');
    }

    function renderArticleList() {
      const articles = getUserArticles();
      const table = document.getElementById('articleTable');
      const empty = document.getElementById('emptyState');
      const badge = document.getElementById('articleCountBadge');

      badge.textContent = articles.length;

      // Remove old rows (keep header)
      table.querySelectorAll('.article-row:not(.header)').forEach(r => r.remove());

      if (articles.length === 0) {
        empty.style.display = 'block';
        table.style.display = 'none';
        return;
      }

      empty.style.display = 'none';
      table.style.display = 'block';

      articles.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(article => {
        const country = COUNTRIES.find(c => c.id === article.country);
        const row = document.createElement('div');
        row.className = 'article-row';
        row.innerHTML = `
          <div class="article-row-thumb">
            <img src="${article.image}" alt="" loading="lazy">
          </div>
          <div class="article-row-title">${article.title}</div>
          <div class="article-row-country">${country ? country.emoji + ' ' + country.name : ''}</div>
          <div class="article-row-date">${article.date}</div>
          <div class="article-row-actions">
            <button class="btn btn-sm btn-primary" onclick="editArticle(${article.id})">ç·¨è¼¯</button>
            <button class="btn btn-sm btn-danger" onclick="deleteArticle(${article.id})">åˆªé™¤</button>
          </div>`;
        table.appendChild(row);
      });
    }
  </script>
</body>
</html>
